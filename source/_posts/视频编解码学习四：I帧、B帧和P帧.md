---
title: 视频编解码学习四：I帧、B帧和P帧
date: 2019-02-1 23:30:07
tags:
    - 视频编解码
    - 编解码
categories:
    - 音视频开发
mathjax: true
---

## I帧、B帧、P帧简介

帧指的是是视频中的单幅画面,多个帧连起来就构成了视频。而在编码视频压缩过程中，为了节省存储空间，并不会将每一帧的信息都会完完全全保留下来，会采用各种方法来减少视频数据大小,其中生成I、B、P帧就是一种编码器常采用的办法。

- I frame(Inter frame)：**帧内编码帧**，I帧是原采样图像经过适度地压缩的产物，可以当成图象，做为随机访问的参考点。I帧可以看成是一个RAW图像经过压缩后的图像，一般帧的压缩率是7（跟JPEG差不多）。

- P frame(Forward Predicted pictures): **前向预测编码帧**，通过充分将低于图像序列中前面已编码帧的时间冗余信息来压缩传输数据量的编码图像，也叫预测帧；

- B frame(Bidirectionally predicted pictures): **双向预测内插编码帧**，既考虑与源图像序列前面已编码帧，也顾及源图像序列后面已编码帧之间的时间冗余信息来压缩传输数据量的编码图像，也叫双向预测帧；

- PTS：Presentation Time Stamp。PTS主要用于度量解码后的视频帧什么时候被显示出来

- DTS：Decode Time Stamp。DTS主要是标识读入内存中的bit流在什么时候开始送入解码器中进行解码。

ps:在没有B帧存在的情况下DTS的顺序和PTS的顺序应该是一样的。

## IBP帧编码解码过程

以著名的《旺角卡门》名场面为例：

### 视频的原始采样

![TIM截图20190201212730.png](https://i.loli.net/2019/02/01/5c545e591f1af.png)

### 编码生成I、B、P帧

I帧只使用本帧内的数据进行编码，在编码过程中它不需要进行运动估计和运动补偿。

P帧在编码过程中使用一个前面的I帧或P帧作为参考图像进行**运动补偿**，实际上是对当前图像与参考图像的差值进行编码。B帧的编码方式与P帧相似，惟一不同的地方是在编码过程中它要**使用一个前面的I帧或P帧和一个后面的I帧或P帧进行预测**。

使用P图像可以保持高压缩比。但是，如果与前一帧有太多场景变化，使用P帧可能会降低图像质量。如果检测到两帧之间发生较大变化，则编码器自动插入I帧。

由此可见，每一个P帧的编码需要利用一帧图像作为参考图像，而B帧则需要两帧图像作为参考。相比之下，B帧比P帧拥有更高的压缩比。

![TIM截图20190201214903.png](https://i.loli.net/2019/02/01/5c545e58f2558.png)

### 解码时还原帧

![TIM截图20190201215307.png](https://i.loli.net/2019/02/01/5c545e591e2d8.png)

## I帧、B帧、P帧的特点

### I 帧特点:
    1）它是一个全帧压缩编码帧。它将全帧图像信息进行 JPEG 压缩编码及传输;

    2）解码时仅用 I 帧的数据就可重构完整图像;

    3）I 帧描述了图像背景和运动主体的详情;

    4）I 帧不需要参考其他画面而生成;

    5）I 帧是 P 帧和 B 帧的参考帧(其质量直接影响到同组中以后各帧的质量);

    6）I 帧是帧组 GOP 的基础帧(第一帧),在一组中只有一个 I 帧;

    7）I 帧不需要考虑运动矢量;

    8）I 帧所占数据的信息量比较大。

### B 帧特点
    1）B 帧是由前面的 I 或 P 帧和后面的 P 帧来进行预测的;

    2）B 帧传送的是它与前面的 I 或 P 帧和后面的 P 帧之间的预测误差及运动矢量;

    3）B 帧是双向预测编码帧;

    4）B 帧压缩比最高，因为它只反映丙参考帧间运动主体的变化情况,预测比较准确;

    5）B 帧不是参考帧,不会造成解码错误的扩散。

### P 帧特点:
    1）P 帧是 I 帧后面相隔 1~2 帧的编码帧;

    2）P 帧采用运动补偿的方法传送它与前面的 I 或 P 帧的差值及运动矢量(预测误差);

    3）解码时必须将 I 帧中的预测值与预测误差求和后才能重构完整的 P 帧图像;

    4）P 帧属于前向预测的帧间编码。它只参考前面最靠近它的 I 帧或 P 帧;

    5）P 帧可以是其后面 P 帧的参考帧,也可以是其前后的 B 帧的参考帧;

    6）由于 P 帧是参考帧,它可能造成解码错误的扩散;

    7）由于是差值传送，P 帧的压缩比较高。


编码器生成的I帧、B帧、P帧都可以解码为物理帧，使得视频压缩比变高（I帧压缩率7左右、P帧20、B帧可达50），节省了大量的视频存储空间，在相同码率（单位时间传送的数据位数）下，可以提供更好的画质。

参考：

[https://blog.csdn.net/starzpc/article/details/54668112](https://blog.csdn.net/starzpc/article/details/54668112)

[https://en.wikipedia.org/wiki/Inter_frame](https://en.wikipedia.org/wiki/Inter_frame)