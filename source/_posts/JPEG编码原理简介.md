---
title: JPEG编码原理简介
date: 2019-01-29 22:30:07
tags:
    - JPEG编码
    - 编解码
    - 图像压缩
categories:
    - 音视频开发
mathjax: true
---

## JPEG简介

JPEG（发音：[ˈdʒeɪpɛg]）是一种针对**照片视频**而广泛使用的**有损压缩**标准方法。

这个名称代表Joint Photographic Experts Group（联合图像专家小组）。联合图像专家小组1992年发布了JPEG的标准而在1994年获得了ISO 10918-1的认定。JPEG与视频音频压缩标准的MPEG（Moving Picture Experts Group）很容易混淆，但两者是不同的组织及标准。

![TIM截图20190128134747.png](https://i.loli.net/2019/01/29/5c504733abe62.png)

**划重点：其实JPEG不是一种文件格式，它是由联合图像专家小组推出的一种图像压缩方法（类似于视频中的H.264等编解码标准）。而JPG或者JFIF格式仅仅是一种数据的包装容器（类似于视频中MP4、MOV等封装格式）**。

## JPEG编码流程

JPEG编码的主要流程是：色彩空间转换、下采样（Downsampling）、离散余弦变换（Discrete cosine transform）、量化（Quantization）、熵编码技术（entropy coding）这几步。

### 1、色彩空间转换

我们使用传感器采集到的原始（RAW）图像使用的是RGB色彩空间来表示的。

首先，我们将RGB（红绿蓝）转换为一种称为YUV的不同色彩空间。

- Y成分表示一个像素的亮度
- U和V成分一起表示色调与饱和度。（色度）

下图为分解开的Y、U、V：

![TIM截图20190129213824.png](https://i.loli.net/2019/01/29/5c5058830d150.png)

### 2、下采样（Downsampling）

下采样、也就是减少人类视觉系统不敏感的色度（U和V的成分）。虽然减少了颜色数量，但是人眼并不会察觉到图像质量有任何的差异。

JPEG上这种缩减取样的比例可以是4:4:4（无缩减取样），4:2:2（在水平方向2的倍数中取一个，颜色为之前的1/2），以及最普遍的4:2:0（在水平和垂直方向2的倍数中取一个，颜色为之前的1/4）。

如图：

![TIM截图20190129204920.png](https://i.loli.net/2019/01/29/5c504bde5913a.png)

### 3、离散余弦变换（Discrete cosine transform）

离散余弦变换是一种类似于傅里叶变换的数学工具（不清楚傅里叶变换的同学可以移步：[https://www.bilibili.com/video/av19141078](https://www.bilibili.com/video/av19141078)来简单了解傅里叶变换）.它将信号从**时间域**转换到**频率域**。

这一步，将视频中的每个成分（Y, U, V）生成三个区域，每一个区域再划分成如瓷砖般排列的一个个的8×8子区域，每一子区域使用二维的离散余弦变换（DCT）转换到频率空间。

如果有一个如这样的的8×8的8-比特（0~255）子区域：

如图：

![TIM截图20190129220534.png](https://i.loli.net/2019/01/29/5c505e1535e00.png)

用矩阵表示为：

![TIM截图20190129220547.png](https://i.loli.net/2019/01/29/5c505e159ba10.png)

原始数据每个值的范围是【0-255】，使每个数字减去128，标准化。

![TIM截图20190129220556.png](https://i.loli.net/2019/01/29/5c505e1599aef.png)

且接着使用离散余弦变换，和舍位取最接近的整数，得到结果为

![TIM截图20190129220603.png](https://i.loli.net/2019/01/29/5c505e157d722.png)

左上角之相当大的数值称为DC系数（直流系数）；其他63个值称为AC系数（交流系数）。

### 4、量化（Quantization）

利用人眼对低频数据敏感对高频数据不敏感的特性，我们可以将离散余弦变换后的很多更高频率的成分舍位成为接近0，且剩下很多会变成小的正或负数。

JPEG标准中定义了量化表。

![TIM截图20190129222332.png](https://i.loli.net/2019/01/29/5c50620977226.png)

![TIM截图20190129222338.png](https://i.loli.net/2019/01/29/5c50620975183.png)

使用$Q_Y$量化矩阵与前面所得到的DCT系数矩阵逐项相除，得到结果为：

![TIM截图20190129222526.png](https://i.loli.net/2019/01/29/5c5062872734a.png)

### 5、熵编码技术（entropy coding）

熵编码是一种无损压缩的技术,它使用Z字形（zigzag）将矩阵数据排列。然后将排列后的数据使用哈夫曼编码。

![TIM截图20190129222741.png](https://i.loli.net/2019/01/29/5c5062ecd0312.png)

对于前者量化的系数所作的Z字体序列会是：

−26,
−3, 0,
−3, −2, −6,
2, −4, 1, −3,
1, 1, 5, 1, 2,
−1, 1, −1, 2, 0, 0,
0, 0, 0, −1, −1, 0, 0,
0, 0, 0, 0, 0, 0, 0, 0,
0, 0, 0, 0, 0, 0, 0,
0, 0, 0, 0, 0, 0,
0, 0, 0, 0, 0,
0, 0, 0, 0,
0, 0, 0,
0, 0,
0

当剩下的所有系数都是零，对于过早结束的序列，JPEG有一个特别的霍夫曼编码用词。使用这个特殊的编码用词，EOB，该序列变为

−26,
−3, 0,
−3, −2, −6,
2, −4, 1 −3,
1, 1, 5, 1, 2,
−1, 1, −1, 2, 0, 0,
0, 0, 0, −1, −1, EOB

在这一步数据量得到了极大的压缩。

## 总结

JPEG是一种压缩效率很高的图像压缩算法，主要步骤用图片表示就是：

![TIM截图20190129224710.png](https://i.loli.net/2019/01/29/5c5067af2a153.png)

